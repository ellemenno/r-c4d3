<?xml version="1.0" encoding="UTF-8"?>

<project name="r-c4d3.shared.macros" default="-usage" basedir="./">

<description>
Common macros available to all the build files in the r-c4d3 project.
</description>
	
	<!-- Define reusable macros -->
	<macrodef name="dynamic-property">
		<attribute name="name"/>
		<attribute name="value"/>
		<sequential>
			<property name="@{name}" value="@{value}"/>
		</sequential>
	</macrodef>
	
	<macrodef name="increment-build">
		<attribute name="file" default="build.number"/>
		<sequential>
			<propertyfile file="@{file}" comment="Auto-generated by Ant. Edit not.">
				<entry key="build.number" type="int" operation="+" default="0"/>
			</propertyfile>
		</sequential>
	</macrodef>
	
	<macrodef name="semver" description="sets project-based semver property for versioning (http://semver.org/)">
		<attribute name="major" default="0"/>
		<attribute name="minor" default="0"/>
		<attribute name="project" default="default"/>
		<attribute name="file" default="build.number"/>
		
		<sequential>
			<property file="@{file}"/>
			<dynamic-property name="semver.@{project}" value="@{major}.@{minor}.${build.number}"/>
			<echo message="semver.@{project} is set to '@{major}.@{minor}.${build.number}'"/>
		</sequential>
	</macrodef>
	
	<macrodef name="run-rom" description="opens IGameRom file using R-C4D3 romloader">
		<attribute name="dir" default=""/>
		<attribute name="file" default=""/>
		<attribute name="bin" default="${dir.trunk}/_releases/romloaders/"/>
		<sequential>
			<echo message="- - run-rom macro - -"/>
			<echo message="installing '@{file}' for romloader to open"/>
			
			<copy file="@{dir}/@{file}" tofile="@{bin}/rom.swf" overwrite="true"/>
			<copy file="@{dir}/romloader-config.xml" todir="@{bin}" overwrite="true"/>
			
			<exec osfamily="windows" spawn="true" executable="@{bin}/romloader-desktop-debug${exe}" />
			
			<exec osfamily="mac" spawn="true" executable="open">
				<arg line="-n -a @{bin}/romloader-desktop-debug${exe}"/>
			</exec>
		</sequential>
	</macrodef>

</project>
